; these tests are way more elaborate than they need to be because we may want them to be
; more sophisticated someday; we use limited test cases, but these can be expanded if
; the logic gets more sophisticated.

LAMBDA NDAU = 10**8
LAMBDA MIN_PRIMARY_STAKE = 1000 * NDAU

VAR costake = 0,1,49900,50000
LAMBDA costake_napu = costake * NDAU

VAR primary_stake = 0,1,999,1000,50000
LAMBDA primary_stake_napu = primary_stake * NDAU

VAR existing_target_stake = 0,300,50000
LAMBDA existing_target_stake_napu = existing_target_stake * NDAU

LAMBDA is_primary = 0,1

LAMBDA from_target_napu = primary_stake_napu if is_primary else existing_target_stake_napu
LAMBDA aggregate_napu = costake_napu + primary_stake_napu + existing_target_stake_napu

LAMBDA rules_addr = "rule account address"
LAMBDA primary_addr = "primary account address"
LAMBDA stake_to_addr = rules_addr if is_primary else primary_addr
LAMBDA target_addr = primary_addr if is_primary else "third party address"

LAMBDA expect_bool = (primary_stake_napu >= MIN_PRIMARY_STAKE)
LAMBDA expect = 0 if expect_bool else -1


BEGIN_TEMPLATE
clear
event EVENT_REGISTERNODE
load ../node_operations.chbin

; expect_bool == $expect_bool
; expect = $expect
; ($primary_stake >= $MIN_PRIMARY_STAKE)

; Stack:
; from_target =  $from_target_napu
; from_primary = $primary_stake_napu
; aggregate =    $aggregate_napu
; tx =           {}
; target_addr =   $target_addr
; stake_to_addr = $stake_to_addr
; rules_addr =    $rules_addr
; primary_addr =  $primary_addr

push $primary_addr
push $rules_addr
push $stake_to_addr
push $target_addr
push {}
push $aggregate_napu
push $primary_stake_napu
push $from_target_napu

run
expect -- $expect
